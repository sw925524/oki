<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Okinawa Summer - Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@4.1.0/dist/vuedraggable.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        [v-cloak] { display: none; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; pb-24; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .nav-active { background: #0369a1 !important; color: white !important; transform: scale(1.05); }
        .tab-btn-active { color: #0369a1; border-bottom: 3px solid #0369a1; }
        .flight-card { background: linear-gradient(135deg, #0284c7 0%, #075985 100%); color: white; border-radius: 20px; }
        .fab { position: fixed; right: 20px; bottom: 100px; width: 60px; height: 60px; background: #0369a1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 10px 15px rgba(0,0,0,0.2); z-index: 50; border: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <header class="bg-white px-6 pt-10 pb-6 rounded-b-[40px] shadow-sm">
            <div class="flex justify-between items-end">
                <div>
                    <h1 class="text-2xl font-black text-slate-800">æ²–ç¹©å¤æ—¥</h1>
                    <p class="text-xs text-slate-400 font-bold uppercase">Travel Planner</p>
                </div>
                <div class="text-right flex items-center gap-2 bg-sky-50 p-3 rounded-2xl">
                    <span class="text-2xl">â˜€ï¸</span>
                    <div>
                        <div class="text-sm font-black text-sky-700">28Â°C / é«”æ„Ÿ 30Â°C</div>
                        <div class="text-[10px] text-sky-400 font-bold">Naha, Okinawa</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="px-4 mt-6">
            <div v-if="activeTab === 'plan'">
                <div class="flex overflow-x-auto space-x-3 py-2 no-scrollbar mb-6">
                    <button v-for="day in tripDays" :key="day.date" @click="currentDate = day.date"
                        :class="['flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center bg-white text-slate-400 shadow-sm transition-all', { 'nav-active': currentDate === day.date }]">
                        <span class="text-sm font-black uppercase">{{ day.week }}</span>
                        <span class="text-xl font-black">{{ day.dayNum }}</span>
                    </button>
                </div>

                <draggable v-model="itineraries[currentDate]" item-key="id" handle=".handle" @end="saveData">
                    <template #item="{element, index}">
                        <div>
                            <div v-if="index > 0" class="flex items-center justify-center gap-2 my-2 text-slate-300 font-bold text-xs">
                                <span>{{ element.transIcon || 'ğŸš—' }}</span>
                                <span class="border-l-2 border-dotted h-4 border-slate-300"></span>
                                <span>{{ element.transTime || '15' }} min</span>
                            </div>

                            <div v-if="element.category === 'èˆªç­'" class="flight-card p-5 mb-4 handle shadow-lg">
                                <div class="flex justify-between items-center text-[10px] font-bold opacity-70 mb-4 uppercase">
                                    <span>{{ element.flightNo || 'èˆªç­ç·¨è™Ÿ' }}</span>
                                    <span>{{ element.date }}</span>
                                </div>
                                <div class="flex justify-between items-center px-4">
                                    <div class="text-center"><h2 class="text-2xl font-black">KHH</h2><p class="text-[10px]">é«˜é›„</p></div>
                                    <div class="flex-1 border-t-2 border-dashed border-white/30 mx-4 relative">
                                        <span class="absolute -top-3 left-1/2 -translate-x-1/2">âœˆï¸</span>
                                    </div>
                                    <div class="text-center"><h2 class="text-2xl font-black">OKA</h2><p class="text-[10px]">æ²–ç¹©</p></div>
                                </div>
                                <div class="flex justify-between mt-4 text-xs font-bold bg-white/10 p-2 rounded-lg">
                                    <span>èµ·é£›: {{ element.time }}</span>
                                    <span>æŠµé”: 12:45</span>
                                </div>
                            </div>

                            <div v-else class="bg-white rounded-2xl p-4 mb-4 shadow-sm flex gap-4 items-center handle" @click="openEdit('plan', index)">
                                <div class="text-3xl">{{ getIcon(element.category) }}</div>
                                <div class="flex-1">
                                    <div class="flex justify-between">
                                        <h3 class="font-bold text-slate-700">{{ element.name }}</h3>
                                        <span class="text-xs font-black text-sky-600">{{ element.time }}</span>
                                    </div>
                                    <div class="flex gap-2 mt-1">
                                        <span v-if="element.openTime" class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-400">ğŸ•’ {{ element.openTime }}</span>
                                        <span v-if="element.ticket" class="text-[10px] bg-orange-50 px-2 py-0.5 rounded text-orange-400">ğŸ« {{ element.ticket }}</span>
                                    </div>
                                    <p class="text-xs text-slate-400 mt-2 line-clamp-1 italic">{{ element.note }}</p>
                                    <button @click.stop="openNav(element.name)" class="mt-3 text-[10px] font-bold text-sky-500 bg-sky-50 px-3 py-1 rounded-full">Google Map å°èˆª â†—</button>
                                </div>
                            </div>
                        </div>
                    </template>
                </draggable>
                <button class="fab" @click="openAdd('plan')">+</button>
            </div>

            <div v-if="activeTab === 'info'" class="space-y-4 pb-10">
                <div class="bg-white p-5 rounded-3xl shadow-sm">
                    <h3 class="font-bold mb-4 flex items-center gap-2">ğŸ’´ åŒ¯ç‡æ›ç®— (1 JPY = 0.21 TWD)</h3>
                    <div class="flex gap-4 items-center">
                        <input type="number" v-model="fx.jpy" @input="fx.twd = (fx.jpy * 0.21).toFixed(0)" class="w-full bg-slate-50 p-4 rounded-2xl outline-none font-bold text-blue-600" placeholder="è¼¸å…¥æ—¥å¹£">
                        <span>âœ</span>
                        <div class="w-full bg-slate-50 p-4 rounded-2xl font-bold text-slate-700">TWD {{ fx.twd }}</div>
                    </div>
                </div>
                <div class="bg-white p-5 rounded-3xl shadow-sm space-y-4">
                    <h3 class="font-bold border-b pb-2">ğŸ¨ ä½å®¿èˆ‡ç§Ÿè»Š</h3>
                    <div v-for="info in infoList" class="flex justify-between items-center bg-slate-50 p-3 rounded-xl">
                        <div>
                            <div class="font-bold text-sm text-slate-700">{{ info.title }}</div>
                            <div class="text-[10px] text-slate-400">{{ info.sub }}</div>
                        </div>
                        <button @click="openNav(info.title)" class="text-xs bg-white px-3 py-1 rounded-lg border text-sky-600 font-bold shadow-sm">å°èˆª</button>
                    </div>
                </div>
                <div class="bg-red-50 p-5 rounded-3xl shadow-sm border border-red-100">
                    <h3 class="font-bold text-red-600 mb-2">ğŸš¨ ç·Šæ€¥é†«ç™‚ (Emergency)</h3>
                    <p class="text-xs text-red-400 font-bold">è­¦å¯Ÿ: 110 / æ•‘è­·è»Š: 119</p>
                </div>
            </div>

            <div v-if="activeTab === 'cost'" class="pb-10">
                <div class="bg-[#0369a1] text-white p-6 rounded-3xl shadow-lg mb-6 flex justify-between items-center">
                    <div><p class="text-xs opacity-70 font-bold uppercase">Total Spend</p><h2 class="text-3xl font-black">Â¥ {{ totalCost }}</h2></div>
                    <div class="text-right text-[10px] opacity-70 font-bold">ç´„ NT$ {{ (totalCost * 0.21).toFixed(0) }}</div>
                </div>
                <div v-for="(item, index) in costs" :key="index" class="bg-white p-4 rounded-2xl mb-3 shadow-sm flex justify-between items-center" @click="openEdit('cost', index)">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center">{{ getCostIcon(item.category) }}</div>
                        <div>
                            <div class="font-bold text-slate-700">{{ item.name }}</div>
                            <div class="text-[10px] text-slate-400 font-bold uppercase">{{ item.date }} Â· {{ item.payMethod }}</div>
                        </div>
                    </div>
                    <div class="font-black text-slate-700">Â¥ {{ item.amount }}</div>
                </div>
                <button class="fab" @click="openAdd('cost')">+</button>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 h-20 bg-white/90 backdrop-blur-md border-t flex justify-around items-center z-40 px-6">
            <button @click="activeTab = 'plan'" :class="{'tab-btn-active': activeTab === 'plan'}" class="flex flex-col items-center p-2 text-slate-300 transition-all">
                <span class="text-xl">ğŸ“</span><span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="activeTab = 'info'" :class="{'tab-btn-active': activeTab === 'info'}" class="flex flex-col items-center p-2 text-slate-300 transition-all">
                <span class="text-xl">â„¹ï¸</span><span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
            <button @click="activeTab = 'cost'" :class="{'tab-btn-active': activeTab === 'cost'}" class="flex flex-col items-center p-2 text-slate-300 transition-all">
                <span class="text-xl">ğŸ’°</span><span class="text-[10px] font-bold">èŠ±è²»</span>
            </button>
        </nav>

        <div v-if="showModal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-end">
            <div class="bg-white w-full rounded-t-[40px] p-8 animate-slide-up shadow-2xl overflow-y-auto max-h-[90vh]">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-black text-slate-800">{{ isEdit ? 'ä¿®æ”¹' : 'æ–°å¢' }}é …ç›®</h3>
                    <button @click="showModal = false" class="text-slate-300 text-2xl font-bold">âœ•</button>
                </div>

                <div v-if="modalType === 'plan'" class="space-y-4">
                    <input v-model="form.name" placeholder="åœ°é»åç¨±" class="w-full bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                    <div class="flex gap-2">
                        <select v-model="form.category" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                            <option v-for="c in ['æ™¯é»','ä½å®¿','ç¾é£Ÿ','è³¼ç‰©','èˆªç­','å…¶ä»–']">{{c}}</option>
                        </select>
                        <input type="time" v-model="form.time" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                    </div>
                    <div class="flex gap-2">
                        <input v-model="form.openTime" placeholder="ç‡Ÿæ¥­æ™‚é–“" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none text-sm">
                        <input v-model="form.ticket" placeholder="é–€ç¥¨è²»ç”¨" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none text-sm">
                    </div>
                    <div class="flex gap-2 items-center bg-slate-50 p-2 rounded-2xl">
                        <select v-model="form.transIcon" class="w-20 bg-transparent font-bold">
                            <option>ğŸš—</option><option>ğŸš¶</option><option>ğŸšŒ</option>
                        </select>
                        <input type="number" v-model="form.transTime" placeholder="äº¤é€šæ™‚é–“(åˆ†)" class="bg-transparent text-sm">
                    </div>
                    <textarea v-model="form.note" placeholder="ç‰¹è‰²èˆ‡å‚™è¨»..." class="w-full bg-slate-100 p-4 rounded-2xl outline-none h-24 text-sm"></textarea>
                </div>

                <div v-if="modalType === 'cost'" class="space-y-4">
                    <input v-model="form.name" placeholder="æ¶ˆè²»åç¨±" class="w-full bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                    <div class="flex gap-2">
                        <select v-model="form.category" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                            <option v-for="c in ['äº¤é€š','é£²é£Ÿ','ä½å®¿','é–€ç¥¨','è³¼ç‰©','å…¶ä»–']">{{c}}</option>
                        </select>
                        <input type="date" v-model="form.date" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                    </div>
                    <div class="flex gap-2">
                        <input type="number" v-model="form.amount" placeholder="é‡‘é¡ (æ—¥å¹£)" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-black text-blue-600">
                        <select v-model="form.payMethod" class="flex-1 bg-slate-100 p-4 rounded-2xl outline-none font-bold">
                            <option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-3 mt-8">
                    <button v-if="isEdit" @click="deleteItem" class="flex-1 py-4 bg-red-50 text-red-500 rounded-2xl font-bold">åˆªé™¤</button>
                    <button @click="save" class="flex-[2] py-4 bg-sky-600 text-white rounded-2xl font-bold shadow-lg shadow-sky-100">å„²å­˜è®Šæ›´</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const activeTab = ref('plan');
                const currentDate = ref('2025-04-14');
                const showModal = ref(false);
                const modalType = ref('plan');
                const isEdit = ref(false);
                const currentIdx = ref(null);
                const fx = ref({ jpy: 0, twd: 0 });

                const tripDays = [
                    { date: '2025-04-14', week: 'Mon', dayNum: '14' },
                    { date: '2025-04-15', week: 'Tue', dayNum: '15' },
                    { date: '2025-04-16', week: 'Wed', dayNum: '16' },
                    { date: '2025-04-17', week: 'Thu', dayNum: '17' },
                    { date: '2025-04-18', week: 'Fri', dayNum: '18' }
                ];

                const itineraries = ref({
                    '2025-04-14': [{ id: 1, category: 'èˆªç­', flightNo: 'IT288', time: '10:10', name: 'å¾€æ²–ç¹©èˆªç­', date: '04-14' }],
                    '2025-04-15': [], '2025-04-16': [], '2025-04-17': [], '2025-04-18': []
                });

                const costs = ref([]);
                const infoList = ref([
                    { title: 'é‚£éœ¸å¸Œçˆ¾é “é£¯åº—', sub: 'ä½å®¿ Â· 098-123-456' },
                    { title: 'Toyota Rent a Car', sub: 'ç§Ÿè»Š Â· é‚£éœ¸æ©Ÿå ´åº—' }
                ]);

                const form = ref({});

                const totalCost = computed(() => costs.value.reduce((sum, item) => sum + Number(item.amount || 0), 0));

                const saveData = () => {
                    localStorage.setItem('OKI_V10_DATA', JSON.stringify({
                        itineraries: itineraries.value,
                        costs: costs.value
                    }));
                };

                const loadData = () => {
                    const saved = localStorage.getItem('OKI_V10_DATA');
                    if (saved) {
                        const data = JSON.parse(saved);
                        itineraries.value = data.itineraries;
                        costs.value = data.costs || [];
                    }
                };

                const openAdd = (type) => {
                    modalType.value = type;
                    isEdit.value = false;
                    if (type === 'plan') {
                        form.value = { id: Date.now(), category: 'æ™¯é»', time: '12:00', transIcon: 'ğŸš—', transTime: 15, name: '', note: '', openTime: '', ticket: '' };
                    } else {
                        form.value = { name: '', category: 'é£²é£Ÿ', date: currentDate.value, amount: '', payMethod: 'ç¾é‡‘' };
                    }
                    showModal.value = true;
                };

                const openEdit = (type, index) => {
                    modalType.value = type;
                    isEdit.value = true;
                    currentIdx.value = index;
                    form.value = type === 'plan' ? { ...itineraries.value[currentDate.value][index] } : { ...costs.value[index] };
                    showModal.value = true;
                };

                const save = () => {
                    if (!form.value.name) return alert("è«‹è¼¸å…¥åç¨±");
                    if (modalType.value === 'plan') {
                        if (isEdit.value) itineraries.value[currentDate.value][currentIdx.value] = { ...form.value };
                        else itineraries.value[currentDate.value].push({ ...form.value });
                    } else {
                        if (isEdit.value) costs.value[currentIdx.value] = { ...form.value };
                        else costs.value.push({ ...form.value });
                    }
                    saveData();
                    showModal.value = false;
                };

                const deleteItem = () => {
                    if (confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
                        if (modalType.value === 'plan') itineraries.value[currentDate.value].splice(currentIdx.value, 1);
                        else costs.value.splice(currentIdx.value, 1);
                        saveData();
                        showModal.value = false;
                    }
                };

                const getIcon = (cat) => ({ 'æ™¯é»':'ğŸ–ï¸','ä½å®¿':'ğŸ¨','ç¾é£Ÿ':'ğŸœ','è³¼ç‰©':'ğŸ›ï¸','èˆªç­':'âœˆï¸','å…¶ä»–':'ğŸ“' }[cat]);
                const getCostIcon = (cat) => ({ 'äº¤é€š':'ğŸš—','é£²é£Ÿ':'ğŸ±','ä½å®¿':'ğŸ¨','é–€ç¥¨':'ğŸ«','è³¼ç‰©':'ğŸ›ï¸','å…¶ä»–':'ğŸ’°' }[cat]);
                const openNav = (name) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name)}`, '_blank');

                onMounted(loadData);

                return {
                    activeTab, currentDate, tripDays, itineraries, costs, totalCost, infoList, fx,
                    showModal, modalType, isEdit, form, openAdd, openEdit, save, deleteItem, getIcon, getCostIcon, openNav, saveData
                };
            }
        }).component('draggable', window.vuedraggable).mount('#app');
    </script>
</body>
</html>
